{% extends 'core/base.html' %}
{% load widget_tweaks %}

{% block title %}Initiate_Recovery | Found.it{% endblock %}

{% block content %}
{# --- SYSTEM LOADING OVERLAY --- #}
<div id="loading-overlay" class="fixed inset-0 z-[100] bg-black hidden flex-col items-center justify-center backdrop-blur-md bg-opacity-90">
    <div class="w-64 h-1 bg-slate-800 relative overflow-hidden border border-white/10">
        <div class="absolute inset-0 bg-indigo-500 animate-progress"></div>
    </div>
    <p class="mt-4 text-[10px] font-black text-indigo-500 uppercase tracking-[0.5em] animate-pulse">Broadcasting_Signal...</p>
    <div class="mt-2 text-[8px] font-mono text-slate-500 uppercase">Encrypting_Channel // Handshake_Init</div>
</div>

<div class="min-h-screen bg-slate-50 dark:bg-[#020617] flex items-center justify-center pt-28 pb-20 px-4 transition-colors duration-500 relative">
    
    {# --- CYBER GRID DECORATION --- #}
    <div class="absolute inset-0 z-0 opacity-5 pointer-events-none" 
         style="background-image: radial-gradient(#000 1px, transparent 1px); background-size: 30px 30px;"></div>
    
    <div class="absolute inset-0 z-0 pointer-events-none opacity-[0.03] dark:opacity-[0.07]" 
         style="background: linear-gradient(to bottom, transparent, #6366f1 50%, transparent); background-size: 100% 8px; animation: scan 4s linear infinite;"></div>

    <div class="w-full max-w-[480px] relative z-10">
        
        {# --- SYSTEM STATUS BAR --- #}
        <div class="mb-[-4px] flex justify-between items-end px-4">
            <div class="bg-black dark:bg-white text-white dark:text-black text-[9px] font-black px-3 py-1 uppercase tracking-widest border-t-4 border-x-4 border-black dark:border-white">
                Secure_Line: <span class="text-indigo-500 dark:text-indigo-600 animate-pulse">ACTIVE</span>
            </div>
            <div class="text-[9px] font-mono font-bold text-black dark:text-white uppercase tracking-tighter opacity-40">
                AUTH_NODE: {{ request.META.REMOTE_ADDR|default:"127.0.0.1" }}
            </div>
        </div>

        {# --- RECOVERY CARD --- #}
        <div class="bg-white dark:bg-slate-900 p-8 md:p-12 border-4 border-black dark:border-white shadow-[16px_16px_0px_0px_rgba(0,0,0,1)] dark:shadow-[16px_16px_0px_0px_rgba(99,102,241,0.2)] transition-all duration-300">
            
            {# IDENTITY SENSOR ICON #}
            <div class="text-center mb-10">
                <div class="group relative w-20 h-20 mx-auto mb-6">
                    <div class="absolute inset-0 border-2 border-dashed border-indigo-500 animate-spin-slow opacity-20 group-hover:opacity-100 transition-opacity"></div>
                    <div class="relative w-20 h-20 bg-white dark:bg-slate-800 border-4 border-black dark:border-white flex items-center justify-center shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] dark:shadow-[6px_6px_0px_0px_rgba(99,102,241,1)] transition-transform group-hover:-translate-x-1 group-hover:-translate-y-1">
                        <i class="fas fa-fingerprint text-3xl text-black dark:text-white"></i>
                    </div>
                </div>
                
                <h1 class="text-4xl font-black text-black dark:text-white tracking-tighter uppercase mb-2 italic">Reset_Protocol</h1>
                <p class="text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-[0.2em] leading-relaxed">
                    // SECURITY_LEVEL: USER_RECOVERY <br>
                    // INPUT_GMAIL_NODE_FOR_SYNC
                </p>
            </div>

            <form method="post" novalidate id="recovery-form" class="space-y-8">
                {% csrf_token %}
                
                {# GMAIL/EMAIL FIELD #}
                <div class="form-group text-left relative">
                    <div class="flex justify-between items-center mb-2 px-1">
                        <label for="{{ form.email.id_for_label }}" class="text-[11px] font-black uppercase tracking-widest text-indigo-600 dark:text-indigo-400">
                            Primary_Gmail_Node
                        </label>
                        <span id="char-count" class="text-[9px] font-mono text-slate-400 dark:text-slate-500 tracking-widest">00/64</span>
                    </div>
                    
                    <div class="relative group">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-black dark:text-slate-400 z-10 transition-colors group-focus-within:text-indigo-500">
                            <i class="fa-solid fa-at text-xs"></i>
                        </span>
                        
                        {% render_field form.email class="w-full p-4 pl-12 border-4 border-black dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-sm font-bold text-black dark:text-white focus:outline-none focus:ring-0 focus:border-indigo-500 dark:focus:border-indigo-400 transition-all placeholder:text-slate-400 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] dark:shadow-[4px_4px_0px_0px_rgba(99,102,241,0.1)]" placeholder="USER_GMAIL_NODE@GMAIL.COM" oninput="updateCount(this)" %}
                    </div>

                    {% if form.email.errors %}
                        <div class="mt-4 bg-rose-600 border-2 border-black p-3 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] animate-glitch">
                            {% for error in form.email.errors %}
                                <p class="text-[10px] font-black text-white uppercase tracking-tighter mb-0 flex items-center italic">
                                    <i class="fas fa-exclamation-triangle mr-2"></i> DATA_MISMATCH: {{ error }}
                                </p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                {# SUBMIT BUTTON #}
                <div class="relative pt-2">
                    <button type="submit" class="group relative w-full bg-black dark:bg-white text-white dark:text-black border-4 border-black dark:border-white py-5 text-[13px] font-black uppercase tracking-[0.4em] shadow-[8px_8px_0px_0px_rgba(99,102,241,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] active:translate-x-0 active:translate-y-0 active:shadow-none transition-all cursor-pointer overflow-hidden">
                        <span class="relative z-10">Commit_Recovery_Signal</span>
                        <div class="absolute inset-0 bg-indigo-600 translate-x-full group-hover:translate-x-0 transition-transform duration-500 z-0 opacity-90"></div>
                    </button>
                    <div class="absolute -top-1 -left-1 w-3 h-3 bg-indigo-500 z-20"></div>
                </div>
            </form>

            {# FOOTER LINKS #}
            <div class="mt-12 pt-8 border-t-4 border-double border-slate-200 dark:border-slate-800 flex justify-between items-center">
                <a href="{% url 'core:login' %}" class="group text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 hover:text-indigo-500 dark:hover:text-white no-underline flex items-center transition-colors">
                    <span class="mr-2 transition-transform group-hover:-translate-x-1">â‹˜</span> Return_to_Auth
                </a>
                <div class="flex gap-1">
                    <div class="w-2 h-2 bg-slate-200 dark:bg-slate-800"></div>
                    <div class="w-2 h-2 bg-slate-300 dark:bg-slate-700"></div>
                    <div class="w-2 h-2 bg-indigo-500"></div>
                </div>
            </div>
        </div>
        
        {# SYSTEM VERSION #}
        <div class="mt-6 flex justify-between items-center opacity-20 px-2">
            <div class="text-[8px] font-mono text-black dark:text-white">SYS_REV: 2.0.5</div>
            <div class="flex-1 mx-4 h-px bg-black dark:bg-white"></div>
            <div class="text-[8px] font-mono text-black dark:text-white">RECOVERY_MODE</div>
        </div>
    </div>
</div>

<style>
    @keyframes scan {
        0% { transform: translateY(-100%); opacity: 0; }
        50% { opacity: 1; }
        100% { transform: translateY(100%); opacity: 0; }
    }
    @keyframes progress {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    @keyframes glitch {
        0% { transform: translate(0) }
        20% { transform: translate(-2px, 2px) }
        40% { transform: translate(-2px, -2px) }
        60% { transform: translate(2px, 2px) }
        80% { transform: translate(2px, -2px) }
        100% { transform: translate(0) }
    }
    .animate-progress { animation: progress 1.5s infinite linear; }
    .animate-glitch { animation: glitch 0.3s ease-in-out infinite; }
    .animate-spin-slow { animation: spin 12s linear infinite; }
</style>

<script>
    function updateCount(el) {
        const count = el.value.length;
        document.getElementById('char-count').innerText = (count < 10 ? '0' : '') + count + '/64';
        
        if (count > 0) {
            el.classList.add('border-indigo-500');
        } else {
            el.classList.remove('border-indigo-500');
        }
    }

    document.getElementById('recovery-form').onsubmit = function() {
        if (this.checkValidity()) {
            document.getElementById('loading-overlay').classList.remove('hidden');
            document.getElementById('loading-overlay').classList.add('flex');
        }
    };
</script>
{% endblock %}