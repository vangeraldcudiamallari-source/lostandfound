{% extends 'core/base.html' %}
{% load humanize %}

{% block title %}Command Center | Found.it{% endblock %}

{% block content %}
<div class="min-h-screen bg-brand dark:bg-[#020617] pt-28 pb-20 px-4 md:px-8 transition-colors duration-500 overflow-hidden relative">
    
    {# --- CRT SCANLINE & GRID OVERLAY --- #}
    <div class="absolute inset-0 z-0 opacity-[0.03] pointer-events-none" 
         style="background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 255, 0, 0.06)); background-size: 100% 4px, 4px 100%;"></div>

    <div class="max-w-7xl mx-auto relative z-10">
        
        {# --- TACTICAL HEADER (UPDATED WITH IDENTITY NODE) --- #}
        <header class="flex flex-col lg:flex-row items-stretch justify-between gap-0 mb-12 border-4 border-black dark:border-white shadow-[12px_12px_0px_0px_rgba(99,102,241,1)] overflow-hidden">
            <div class="bg-white dark:bg-slate-900 p-8 flex-1 border-r-0 lg:border-r-4 border-black dark:border-white flex flex-col md:flex-row items-center gap-8">
                
                {# IDENTITY_NODE: Profile Image #}
                <div class="relative group">
                    <div class="w-32 h-32 border-4 border-black dark:border-white overflow-hidden shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] bg-slate-200">
                        {% if request.user.profile.image %}
                            <img src="{{ request.user.profile.image.url }}" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500">
                        {% else %}
                            <div class="w-full h-full flex items-center justify-center bg-indigo-100 text-indigo-600">
                                <i class="fas fa-user-secret text-5xl"></i>
                            </div>
                        {% endif %}
                    </div>
                    <div class="absolute -bottom-2 -right-2 bg-indigo-600 text-white text-[8px] font-black px-2 py-1 uppercase border-2 border-black">
                        ID_{{ request.user.id|add:1000 }}
                    </div>
                </div>

                <div class="flex-1 text-center md:text-left">
                    <div class="flex items-center justify-center md:justify-start gap-4 mb-2">
                        <div class="w-3 h-3 bg-emerald-500 animate-ping"></div>
                        <span class="text-[10px] font-black uppercase tracking-[0.4em] text-slate-400">Node_Active: {{ request.user.username|upper }}</span>
                    </div>
                    <h1 class="text-5xl md:text-6xl font-black text-black dark:text-white uppercase tracking-tighter italic leading-none m-0">
                        Command_<span class="text-indigo-600">Center</span>
                    </h1>
                    <p class="text-[10px] font-mono text-slate-500 mt-4 uppercase tracking-widest">
                        Comms_ID: {{ request.user.profile.phone|default:"-- LINK_NOT_ESTABLISHED --" }}
                    </p>
                </div>
            </div>
            
            <div class="bg-black dark:bg-slate-800 p-8 flex flex-wrap items-center justify-center gap-6">
                <a href="{% url 'core:edit_profile' %}" class="group text-white text-[10px] font-black uppercase tracking-widest no-underline flex items-center gap-2 hover:text-indigo-400 transition-colors">
                    <i class="fas fa-fingerprint text-lg"></i> Identity_Parameters
                </a>
                <a href="{% url 'core:report_item' %}" class="bg-indigo-600 hover:bg-white hover:text-black text-white px-8 py-4 border-2 border-white font-black text-[11px] uppercase tracking-[0.2em] transition-all shadow-[4px_4px_0px_0px_rgba(255,255,255,0.2)] hover:shadow-none">
                    + New_Broadcast
                </a>
            </div>
        </header>

        {# --- SECTOR GRID --- #}
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            {# --- LEFT COLUMN: SYSTEM STATUS --- #}
            <div class="lg:col-span-4 space-y-8">
                {# STAT CARDS #}
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white dark:bg-slate-900 border-4 border-black p-6 shadow-[6px_6px_0px_0px_rgba(0,0,0,1)]">
                        <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-2">Signals</p>
                        <h2 class="text-4xl font-black text-black dark:text-white leading-none">{{ my_reported_items|length }}</h2>
                    </div>
                    <div class="bg-white dark:bg-slate-900 border-4 border-black p-6 shadow-[6px_6px_0px_0px_rgba(225,29,72,1)]">
                        <p class="text-[9px] font-black text-rose-500 uppercase tracking-widest mb-2">Requests</p>
                        <h2 class="text-4xl font-black text-black dark:text-white leading-none">{{ claims_to_review|length }}</h2>
                    </div>
                </div>

                {# SYSTEM LOGS #}
                <div class="bg-black p-6 border-4 border-black shadow-[8px_8px_0px_0px_rgba(16,185,129,0.1)]">
                    <div class="flex justify-between items-center border-b border-emerald-900/50 pb-3 mb-4">
                        <span class="text-[10px] font-black text-emerald-500 uppercase tracking-[0.3em]">System_Logs</span>
                        <span class="text-[8px] font-mono text-emerald-800 italic">SYNC_STATUS: OK</span>
                    </div>
                    <div class="space-y-3 h-48 overflow-y-auto font-mono text-[10px] text-emerald-500/80 custom-scrollbar">
                        {% for note in notifications %}
                            <p class="leading-tight"><span class="opacity-40">[{{ note.created_at|date:"H:i" }}]</span> > {{ note.text|upper }}</p>
                        {% empty %}
                            <p class="opacity-30 italic">>> MONITORING_NETWORK_STATIC...</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            {# --- RIGHT COLUMN: OPERATIONS --- #}
            <div class="lg:col-span-8 space-y-12">
                
                {# URGENT: INCOMING HANDSHAKES #}
                {% if claims_to_review %}
                <section>
                    <div class="flex items-center gap-3 mb-6 bg-rose-600 text-white p-2 inline-block border-2 border-black">
                        <i class="fas fa-exclamation-triangle animate-pulse"></i>
                        <h5 class="text-[10px] font-black uppercase tracking-[0.2em] m-0">Action_Required: Handshake_Protocol</h5>
                    </div>
                    <div class="space-y-4">
                        {% for claim in claims_to_review %}
                        <div class="bg-white dark:bg-slate-900 border-4 border-black p-6 flex flex-col md:flex-row items-center justify-between gap-6 shadow-[8px_8px_0px_0px_rgba(225,29,72,1)] group hover:translate-x-1 transition-transform">
                            <div class="flex items-center gap-6">
                                <div class="w-14 h-14 bg-black text-rose-500 flex items-center justify-center border-2 border-black">
                                    <i class="fas fa-handshake text-xl group-hover:scale-125 transition-transform"></i>
                                </div>
                                <div>
                                    <h4 class="text-xl font-black text-black dark:text-white uppercase m-0 leading-none">{{ claim.item.title }}</h4>
                                    <p class="text-[9px] font-bold text-slate-400 uppercase mt-2">Origin: <span class="text-indigo-600">@{{ claim.claimant.username }}</span></p>
                                </div>
                            </div>
                            <div class="flex gap-2 w-full md:w-auto">
                                <a href="{% url 'core:start_conversation' item_id=claim.item.id %}" class="flex-1 md:flex-none px-6 py-3 border-2 border-black text-[10px] font-black uppercase hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">Open_Comms</a>
                                <form action="{% url 'core:confirm_resolution' claim.id %}" method="POST" class="flex-1 md:flex-none">
                                    {% csrf_token %}
                                    <button class="w-full bg-black text-white px-6 py-3 border-2 border-black text-[10px] font-black uppercase hover:bg-rose-600 transition-colors cursor-pointer text-center">Execute_Handshake</button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
                {% endif %}

                {# ACTIVE BROADCASTS GRID #}
                <section>
                    <div class="flex items-center justify-between mb-8 border-b-4 border-black dark:border-white pb-2">
                        <h3 class="text-2xl font-black text-black dark:text-white uppercase tracking-tighter m-0 italic">Active_Signals</h3>
                        <span class="text-[10px] font-black text-slate-400">TOTAL_RECORDS: {{ my_reported_items|length }}</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {% for item in my_reported_items %}
                        <div class="bg-white dark:bg-slate-900 border-4 border-black dark:border-white flex flex-col shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] dark:shadow-[8px_8px_0px_0px_rgba(255,255,255,0.05)]">
                            <div class="relative h-40 bg-slate-100 overflow-hidden border-b-2 border-black">
                                {% if item.image %}
                                    <img src="{{ item.image.url }}" class="w-full h-full object-cover grayscale hover:grayscale-0 transition-all duration-700">
                                {% endif %}
                                <div class="absolute bottom-2 left-2 bg-black text-white text-[8px] font-black px-2 py-1 uppercase">{{ item.get_item_type_display }}</div>
                            </div>
                            <div class="p-4">
                                <div class="flex justify-between items-start mb-4">
                                    <h5 class="text-sm font-black uppercase text-black dark:text-white truncate">{{ item.title }}</h5>
                                    <span class="h-2 w-2 {% if item.status == 'resolved' %}bg-slate-300{% else %}bg-emerald-500 animate-pulse{% endif %}"></span>
                                </div>
                                <div class="grid grid-cols-3 gap-2">
                                    <a href="{% url 'core:item_detail' pk=item.pk %}" class="text-center border-2 border-black py-2 text-[8px] font-black uppercase hover:bg-indigo-600 hover:text-white transition-colors">Inspect</a>
                                    <a href="{% url 'core:item_edit' pk=item.pk %}" class="text-center border-2 border-black py-2 text-[8px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-colors">Modify</a>
                                    <form action="{% url 'core:delete_item' item.pk %}" method="POST" class="m-0">
                                        {% csrf_token %}
                                        <button class="w-full border-2 border-black bg-rose-500 text-white py-2 text-[8px] font-black hover:bg-black transition-colors cursor-pointer"><i class="fas fa-trash-alt"></i></button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>

<style>
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
</style>
{% endblock %}